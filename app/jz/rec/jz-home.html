<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>家庭记账</title>
	<link rel="stylesheet" href="../../../mui/css/mui.min.css"/>
    <link rel="stylesheet" href="../../../jxm/css/jxm.css">
    <style type="text/css">
   		.mui-bar {
			-webkit-box-shadow: none;
			box-shadow: none;
		}
		.head-search {
			padding-top: 1px;
			height: 50px !important; 
		}
		.head-search button {
			height: 48px; 
			width: 18%;
			border: none;
			border-radius: 0 !important;
			background-color:#f7f7f7;
		}
		.head-search input {
			width:62%; 
			height: 50px; 
			border: none;
		}
		.label-red {
			padding-left: 5px;
			color:red !important;
		}
		.iconfont{
			font-size:24px;
		}
		h5 {
	    	font-size: 14px;
	    	padding: 8px 5px 6px;
	    	background-color: #efeff4;
	    }
	    
    </style>
    
</head>
<body>
	<header class="mui-bar mui-bar-nav mui-bar-primary">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">家庭记账</h1>
	</header>
	
	<nav class="mui-bar mui-bar-footer">
		<button type="button" id="btnquery" class="mui-btn mui-btn-primary mui-btn-outlined mui-pull-left" style="width: 30%;" >查询</button>
		<button type="button" id="btncommit" class="mui-btn mui-btn-primary mui-pull-right" style="width: 30%;">提交</button>
	</nav>
	
	<div class="mui-content">
		<form>
			
			<h5>基本信息</h5>
			<div class="mui-input-group">
				<div class="mui-input-row">
					<label>科目<span class="label-red">*</span></label>
					<input id='type_name' type="text" class="mui-input-clear" readonly="readonly" placeholder="请选择科目">
					<input type="hidden" name="type_id" id="type_id" value="" />
				</div>
				<div class="mui-input-row">
					<label>账户<span class="label-red">*</span></label>
					<input id='account_name' type="text" class="mui-input-clear" readonly="readonly" placeholder="请选择账户">
					<input type="hidden" name="account_id" id="account_id" value="" />
				</div>
				<div class="mui-input-row">
					<label>金额<span class="label-red">*</span></label>
					<input id='money' name="money" type="number" class="mui-input" value="">
				</div>
				<div class="mui-input-row " style="height: 100px;">
					<label>摘要<span class="label-red">*</span></label>
					<textarea name="read_desc" id="read_desc" rows="3" placeholder="请输入费用用途或收入来源"></textarea>
				</div>
				<div class="mui-input-row" >
					<label>记账日期</label>
					<input id='read_date' type="datetime-local" class="mui-input-clear" placeholder=""/>
				</div>
			</div>
			
			<h5>其它信息</h5>
			<div class="mui-input-group">
				<div class="mui-input-row">
					<label>科目编号</label>
					<input id='type_code' name="type_code" type="text" class="mui-input" disabled="true" value="">
				</div>
				<div class="mui-input-row">
					<label>记账人</label>
					<input id='read_user' name="read_user" type="text" class="mui-input" disabled="true" value="">
					<input type="hidden" name="read_userid" id="read_userid" value="" />
					<input type="hidden" name="read_prop" id="read_prop" value="" />
					<input type="hidden" name="auditing" id="auditing" value="" />
					<input type="hidden" name="read_id" id="read_id" value="" />
					<input type="hidden" name="project_name" id="project_name" value="" />
					<input type="hidden" name="project_id" id="project_id" value="" />
				</div>
			</div>
			
		</form>
	</div>
	
	<script src="../../../mui/js/mui.min.js"></script>
	<script src="../../../jxm/js/jxm.js"></script>
	<script src="../../../jxm/js/jxm-image-input.js"></script>
	<script src="../../../app/util/jxm-util.js"></script>
	<script type="text/javascript" charset="UTF-8">
      	mui.init();
      	
  		var newData = function(){
  			//清除数据
  			var mf = document.getElementsByTagName('form')[0];
  			var inputs = mf.querySelectorAll('input,textarea');
  			[].forEach.call(inputs, function(item) {
  				if (item.id && item.id.length > 0) {
  					item.value = '';
  				}
  			});
			
			//显示缺省值
			document.getElementById('read_user').value = jxm.getSession().user_name;
			document.getElementById('read_userid').value = jxm.getSession().user_id;
			document.getElementById('read_date').value = jxm.getTodayTime().replace(" ","T");
			document.getElementById('read_prop').value = "0";
			document.getElementById('auditing').value = "0";
			document.getElementById('project_name').value = "家庭项目";
			document.getElementById('project_id').value = "jxstar0062";
  		};
  		
  		//提交数据、保存、提交
  		var commitData = function() {
  			plus.nativeUI.showWaiting("正在提交,请耐心等候。。");
  			
  			var money = document.getElementById('money').value;
  			var type_name = document.getElementById('type_name').value;
  			var read_desc = document.getElementById('read_desc').value;
  			var account_name = document.getElementById('account_name').value;
  			
  			if (type_name.length == 0 || account_name.length == 0 || 
  				money.length == 0 || read_desc.length == 0) {
  				plus.nativeUI.closeWaiting();
  				mui.alert('带*星号的信息必须填写！');
  				return false;
  			}
  			
  			var params = '';
  			var e = encodeURIComponent;
  			var mf = document.getElementsByTagName('form')[0];
  			var inputs = mf.querySelectorAll('input,textarea');
  			[].forEach.call(inputs, function(item) {
  				if (item.id && item.id.length > 0) {
  					var v = e(item.value);
  					if (item.id == 'read_date') {
		  				v = jxm.dealDateTime(item.value);
		  			}
		  			params += '&jz_read__'+item.id+'='+v;
  				}
			});
  			console.log('params='+params);
  			
  			//回调函数：保存附件
  			var hdcall = function(data) {
  				console.log('hdcall data='+JSON.stringify(data));
  				setTimeout(function(){
  					newData();
  					
					plus.nativeUI.closeWaiting();
					mui.toast('提交成功！');
				}, 500);
  			};
  			
  			//发送请求
			params = 'funid=jz_home&eventcode=commitdata'+params;
			jxm.post(params, hdcall);
  		};
  		
  		//打开数据查询页面
  		var queryData = function(){
  			var targetWin = plus.webview.getWebviewById('jz-home-list.html');
			if (targetWin) mui.fire(targetWin, 'load-data', {});
  			jxm.open('../../util/pullrefresh_main.html',{extras:{title:'家庭记账',url:'../jz/rec/jz-home-list.html',backUrlId:'bus',addUrl:'../jz/rec/jz-home.html'}});
  		};
  		
  		//选择科目
  		jxm.selectData('select-type', "../util/select-type.html", 'type_name', 'type_id', 'type_code');
		//选择账户
		jxm.selectData('select-account', "../util/select-account.html", 'account_name', 'account_id');
		
		//提交记录
		document.getElementById('btncommit').addEventListener('tap', commitData);
		//查询记录
		document.getElementById('btnquery').addEventListener('tap', queryData);
		
		newData();
    </script>	
</body>
</html>