<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>入库单</title>
		<link rel="stylesheet" href="../../../mui/css/mui.min.css" />
		<link rel="stylesheet" href="../../../jxm/css/jxm.css">
		<link rel="stylesheet" href="../../../ddcg/css/ddcgIcon.css">
		<style>
			.mui-bar {
				-webkit-box-shadow: none;
				box-shadow: none;
			}
			
			.head-search {
				padding-top: 1px;
				height: 50px !important;
			}
			
			.head-search button {
				height: 48px;
				width: 18%;
				border: none;
				border-radius: 0 !important;
				background-color: #f7f7f7;
			}
			
			.head-search input {
				width: 62%;
				height: 50px;
				border: none;
			}
			
			.text-disabled {
				background-color: #EEEEEE;
			}
			
			.iconfont {
				font-size: 24px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav mui-bar-primary">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" id="title">入库</h1>
			<a class="mui-icon mui-pull-right icon-header" id="print_setting">
				<i class="iconfont icon-icon-test"></i>
			</a>
		</header>
		<nav class="mui-bar mui-bar-footer">
			<center>
				<button type="button" id="btnback" onclick="mui.back();" class="mui-btn mui-btn-primary mui-pull-left" style="width:30%;">返回</button>
				<button type="button" id="btncommit" class="mui-btn mui-btn-primary mui-pull-right" style="width:30%;">提交</button>
			</center>
		</nav>
		<div class="mui-content">
			<div class="mui-input-group" style="padding-bottom: 20px;padding-top: 5px;">
				<div class="mui-input-row head-search">
					<button type="button" id="btnscan" class="mui-icon iconfont icon-saoma1 mui-pull-left" style=""></button>
					<!--扫描资产条码-->
					<input type="text" id="barcode" autofocus="autofocus" class="mui-input" placeholder="扫描工单号" />
					<!--资产条码输入框-->
				</div>
				<h5>基本信息</h5>
				<div class="mui-input-row">
					<label style="width: 40%;">工单编号：</label>
					<input style="width: 60%;" type="text" id="pro_code" readonly="readonly"></input>
				</div>
				<div class="mui-input-row">
					<label style="width: 40%;">产品编号：</label>
					<input style="width: 60%;" type="text" id="sp_id" readonly="readonly"></input>
				</div>
				<div class="mui-input-row">
					<label style="width: 40%;">产品名称：</label>
					<input style="width: 60%;" type="text" id="sp_name" readonly="readonly"></input>
				</div>
				<div class="mui-input-row">
					<label style="width: 40%;">工单数量：</label>
					<input style="width: 60%;" type="text" id="pro_num" readonly="readonly"></input>
				</div>
				<h5 style="margin-bottom: 0px;">入库信息</h5>
				<div class="mui-input-row">
					<label style="width: 40%;">入库仓库：</label>
					<input style="width: 60%;" type="text" id="in_store" required="required"></input>
				</div>
				<div class="mui-input-row">
					<label style="width: 40%;">入库数量：</label>
					<input style="width: 60%;" type="number" id="in_num" required="required"></input>
				</div>
			</div>
		</div>
		<script src="../../../mui/js/mui.min.js"></script>
		<script src="../../../jxm/js/jxm.js"></script>
		<script src="../../../jxm/js/JxDao.js"></script>
		<script src="../../../jxm/js/json2.js"></script>
		<script src="../../../jxm/js/jxm-image-input.js"></script>
		<script src="../../util/jxm-util.js"></script>
		<script src="../../../Resources/js/jquery-3.3.1.min.js"></script>
		<script src="../../../Resources/js/juicer-min.js"></script>
		<script src="../../../Resources/js/juicerUtil.js"></script>
		<script type="text/javascript" charset="UTF-8">
			mui.init({
				swipeBack: false //关闭-右滑关闭功能
			});
			document.getElementById("barcode").focus();
			//页面初始化完成加载此方法
			mui.plusReady(function() {});
			/*扫描工单号*/
			document.getElementById('btnscan').addEventListener('tap', function() {
				jxm.open('../../util/barcode_scan.html');
			});
			//扫描工单号完成
			var scanSucess = function(result) {
				$('#barcode').data("code", result);
				addAsset(result);
			};

			//回车后根据工单号读取信息
			document.getElementById('barcode').addEventListener('keypress', function(event) {
				if(event.keyCode == 13) {
					//阻止默认回车键事件
					var barcode = document.getElementById('barcode').value;
					$('#barcode').data("code", barcode);
					$('#barcode').val('');
					addAsset(barcode);
				}
				return false;
			});
			/*工单信息方法*/
			var addAsset = function(barcode) {
				var params = "funid=app_full&eventcode=qryQCWork&qrcode=" + barcode;
				jxm.post(params, function(data) {
					//console.log(JSON.stringify(data));
					console.log(JSON.stringify(data));
					$('#sp_id').val(data.sp_code); //产品编号
					$('#sp_name').val(data.sp_name); //产品名称
					$('#pro_code').val(data.div_code); //工单编号
					$('#pro_num').val(data.div_num); //工单数量
				});
			};
			//上报按钮
			$('#btncommit').on('click', function(e) {
				var user_name = jxm.getUserName();
				var user_id = jxm.getUserId();
				var div_code = $('#pro_code').val();
				var in_store = $('#in_store').val();
				var in_num = $('#in_num').val();
				if(in_store == '') {
					mui.toast("入库仓库必填");
					return;
				} else if(in_num == '') {
					mui.toast("入库数量必填");
					return;
				}
				var params = "funid=app_full&eventcode=upSpIn&user_name=" + user_name + "&user_id=" + user_id + "&div_code=" + div_code + "&in_store=" + in_store + "&in_num=" + in_num;
				jxm.post(params, function(data) {
					mui.toast("提交完成");
					pageClear();
				});
			});
			//清空当前页面控件值
			var pageClear = function() {
				$('#pro_code').val('');
				$('#in_store').val('');
				$('#in_num').val('');
				$('#sp_id').val(''); //产品编号
				$('#sp_name').val(''); //产品名称
				$('#pro_num').val(''); //工单数量
			}
		</script>
	</body>

</html>