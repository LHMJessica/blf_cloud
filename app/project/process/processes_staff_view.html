<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<title>员工报工统计</title>
		<link rel="stylesheet" href="../../../mui/css/mui.min.css" />
		<link rel="stylesheet" href="../../../jxm/css/jxm.css">
		<link rel="stylesheet" href="../../../mui/css/main.css">
		<style type="text/css">
			.mui-bar {
				-webkit-box-shadow: none;
				box-shadow: none;
			}
			
			.head-search {
				padding-top: 1px;
				height: 50px !important;
			}
			
			.head-search button {
				height: 48px;
				width: 18%;
				border: none;
				border-radius: 0 !important;
				background-color: #f7f7f7;
			}
			
			.head-search input {
				width: 62%;
				height: 50px;
				border: none;
			}
			.iconfont {
				font-size: 24px;
			}
			
			h5 {
				font-size: 14px;
				padding: 8px 5px 6px;
				background-color: #efeff4;
			}
			.mspan {
				overflow-x: scroll;
				display: block;
				width: 100%;
				overflow-y: hidden;
				white-space: pre-wrap;
				word-break: break-all;
				margin-top: 3%;
			}
			
			.mui-bar-footer {
				height: auto !important;
			}
			
			.total p {
				display: inline-block;
				vertical-align: middle;
				margin: 5px 10px;
				font-size: 16px;
			}
			
			table th,
			table td {
				width: auto;
				text-align: center;
				font-size: 12px;
			}
			
			.mui-checkbox.mui-left label,
			.mui-radio.mui-left label {
				padding: 5px 41px;
				width: 130px;
			}
			
			.mui-checkbox input[type=checkbox]:before,
			.mui-radio input[type=radio]:before {
				font-size: 20px;
				line-height: 30px;
			}
			
			table th:nth-child(8),
			table td:nth-child(8) {
				width: 9%;
			}
			table th:nth-child(10),
			table td:nth-child(10) {
				width: 16%;
			}
			
			table th:nth-child(9),
			table td:nth-child(9) {
				width: 8%;
			}
			
			table th:nth-child(11),
			table td:nth-child(11) {
				width: 6%;
			}
			
			table th:nth-child(1),
			table td:nth-child(1) {
				width: 4%;
			}
			
			table th:nth-child(6),
			table td:nth-child(6) {
				width: 9%;
			}
			
			table th:nth-child(7),
			table td:nth-child(7) {
				width: 7%;
			}
			
			table th:nth-child(2),
			table td:nth-child(2) {
				color: #00AAEF;
				width: 5%;
			}
			
			table th:nth-child(3),
			table td:nth-child(3) {
				color: #00AAEF;
				width: 6%;
			}
			
			table th:nth-child(4),
			table td:nth-child(4) {
				color: green;
				width: 6%;
			}
			
			table th:nth-child(5),
			table td:nth-child(5) {
				color: green;
				width: 6%;
			}
			
			.radio_row {
				display: inline-block;
				width: 32%;
				height: 30px;
				vertical-align: middle;
			}
			
			.radio_row {
				display: inline-block;
				width: 32%;
				height: 30px;
				vertical-align: middle;
			}
			
			.radio_row label {
				height: 30px;
				line-height: 30px;
				text-align: right;
			}
			
			table th:nth-child(12),
			table td:nth-child(12) {
				color: #00AAEF;
				width: 6%;
			}
			#datas tr{
				line-height: normal;
			}
		</style>

	</head>

	<body>
		<header class="mui-bar mui-bar-nav mui-bar-primary">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" id="title">员工报工统计</h1>
			<a class="mui-icon mui-icon-search mui-pull-right" id="search"></a>
		</header>

		<nav class="mui-bar mui-bar-footer">
			<center>
				<div class="mui-pull-right total">
					<p>合计金额：<span id="total_money" style="color: red;"></span></p>
					<p>达成率：<span id="total_rate" style="color: red;"></span></p>
				</div>
			</center>
		</nav>
		<div class="mui-content">
			<div class="mui-content-header">
				<form class="mui-input-group">
					<div id="search-box">
						<div class="mui-input-row">
							<label style="width: 30%;">起始时间：</label>
							<input type="date" id="start_date" style="width: 70%;" />
						</div>
						<div class="mui-input-row">
							<label style="width: 30%;">结束时间：</label>
							<input type="date" id="end_date" style="width: 70%;" />
						</div>
						<div class="mui-input-row">
							<div class="radio_row mui-radio mui-left">
								<label>全部</label>
								<input name="radio1" type="radio" value="" checked="checked">
							</div>
							<div class="radio_row mui-radio mui-left">
								<label>未核对</label>
								<input name="radio1" type="radio" value="0">
							</div>
							<div class="radio_row mui-radio mui-left">
								<label>已核对</label>
								<input name="radio1" type="radio" value="1">
							</div>
						</div>
						<div class="mui-input-row">
							<input type="button" value="查询" id="dosearch" style="width: 80%;margin: 5px 10%;color: #FFFFFF;background-color: deepskyblue;border-radius:5px 5px ;" />
						</div>
					</div>

				</form>
			</div>
			<div class="mui-content-body">
				<table cellspacing="0" cellpadding="0" style="width: 300%;overflow-x:scroll;overflow-y: scroll;">
					<thead>
						<tr>
							<th><span class='mspan'>日期</span></th>
							<th style="background: #00AAEF;color: #ffffff;"><span class='mspan'>计件工资</span></th>
							<th style="background: #00AAEF;color: #ffffff;"><span class='mspan'>日工资</span></th>
							<th style="background: green;color: #ffffff;"><span class='mspan'>工序达成率</span></th>
							<th style="background: green;color: #ffffff;"><span class='mspan'>日达成率</span></th>
							<th><span class='mspan'>生产单号</span></th>
							<th><span class='mspan'>产品代码</span></th>
							<th><span class='mspan'>产品名称</span></th>
							<th><span class='mspan'>工序代码</span></th>
							<th><span class='mspan'>工序名称</span></th>
							<th><span class='mspan'>数量</span></th>
							<th style="background: #00AAEF;color: #ffffff;"><span class='mspan'>单价</span></th>
						</tr>
					</thead>
					<tbody id="datas">

					</tbody>
				</table>
			</div>
		</div>

		<script src="../../../mui/js/mui.min.js"></script>
		<script src="../../../jxm/js/jxm.js"></script>
		<script src="../../util/jxm-util.js" type="text/javascript" charset="utf-8"></script>
		<script src="../../../Resources/js/jquery-3.3.1.min.js"></script>
		<script type="text/javascript" charset="UTF-8">
			mui.init({
				swipeBack: false //关闭-右滑关闭功能
			});
			//页面初始化完成加载此方法
			mui.plusReady(function() {
				dateFormat(jxm.getTimeStamp());
				loadPage();
			});
			//单选按钮选中事件切换
			$("input[type=radio]").on("change", function() {
				loadPage();
			});

			/**
			 * 格式化返回的数据并追加到表格
			 * @param {Object} data
			 */
			var appendTable = function(data) {
				var html = '';
				$.each(data, function(i, result) {
					if(i == data.length - 1) {
						$("#total_money").html("￥" + parseFloat(result.total_money).toFixed(2));
						$("#total_rate").html((parseFloat(result.total_rate)).toFixed(2) + "%");
					} else {
						var dateStr = result["work_date"];
						if(dateStr != '' && dateStr != null) {
							dateStr = result["work_date"].substr(5, 9);
						}
						html += '<tr class="tabOnesub_list">' +
							'<td><span  class="mspan">' + dateStr + '</span><span class="mui-hidden">' + result["edit_user"] + '</span></td>' +
							'<td><span  class="mspan" >' + result["money"] + '</span></td>' +
							'<td><span  class="mspan" >' + result["day_money"] + '</span><span class="mui-hidden">' + dateStr + '</span></td>' +
							'<td><span  class="mspan" >' + result["process_rate"] + '%</span></td>' +
							'<td><span  class="mspan" >' + result["day_rate"] + '%</span><span class="mui-hidden">' + dateStr + '</span></td>' +
							'<td><span  class="mspan" >' + result["order_code"] + '</span></td>' +
							'<td><span  class="mspan" >' + result["sp_code"] + '</span></td>' +
							'<td><span  class="mspan" >' + result["sp_name"] + '</span></td>' +
							'<td><span  class="mspan" >' + result["process_code"] + '</span></td>' +
							'<td><span  class="mspan" >' + result["process_name"] + '</span></td>' +
							'<td><span  class="mspan" >' + result["work_num"] + '</span></td>' +
							'<td><span  class="mspan" >' + result["process_cost"] + '</span></td>' +
							'</tr>';
					}
				})
				$('#datas').html(html);			
				_w_table_rowspan("#datas", 1);
				_w_table_rowspan("#datas", 3);
				_w_table_rowspan("#datas", 5);
				$("#datas tr:event").css({"background-color":"#f2f2f2"}).children("td").css({"border-top":"none","border-bottom":"none"});
			}
			//页面加载执行方法
			var loadPage = function() {
				var start_date = $("#start_date").val();
				var end_date = $("#end_date").val();
				var status = $("input[type=radio]:checked").val();
				if(start_date == "" || start_date == undefined) {
					mui.toast("起始时间必填");
					return;
				}
				if(end_date == "" || end_date == undefined) {
					mui.toast("结束时间必填");
					return;
				}
				var params = "funid=app_full&eventcode=work_total&end_date=" + end_date + "&start_date=" + start_date + "&edit_userid=" + jxm.getUserId() + "&dept_id=" + "&status=" + status;
				jxm.post(params, function(data) {
					appendTable(data);
				});
			};

			/**
			 * 格式化日期  参数格式 YYYYMMddHHmmss
			 * @param {Object} date
			 */
			var dateFormat = function(date) {
				var year = date.substr(0, 4);
				var month = date.substr(4, 2);
				var day = date.substr(6, 2);
				var hh = date.substr(8, 2);
				var mm = date.substr(10, 2);
				var str = year + "-" + month + "-" + day;
				$("#start_date").val(str);
				$("#end_date").val(str);
			}
			$("#search").on("click", function() {
				$("#search-box").toggle();
			});
			$("#dosearch").on("click", function() {
				var start_date = $("#start_date").val();
				var end_date = $("#end_date").val();
				var status = $("input[type=radio]:checked").val();
				if(start_date == "" || start_date == undefined) {
					mui.toast("起始时间必填");
					return;
				}
				if(end_date == "" || end_date == undefined) {
					mui.toast("结束时间必填");
					return;
				}
				var params = "funid=app_full&eventcode=work_total&end_date=" + end_date + "&start_date=" + start_date + "&edit_userid=" + jxm.getUserId() + "&dept_id=" + "&status=" + status;;
				jxm.post(params, function(data) {
					appendTable(data);
				});
			});
			//函数说明：合并指定表格（表格id为_w_table_id）指定列（列数为_w_table_colnum）的相同文本的相邻单元格
			//参数说明：_w_table_id 为需要进行合并单元格的表格的id。如在HTMl中指定表格 id="data" ，此参数应为 #data 
			//参数说明：_w_table_colnum 为需要合并单元格的所在列。为数字，从最左边第一列为1开始算起。
			var _w_table_rowspan = function(_w_table_id, _w_table_colnum) {
				_w_table_firsttd = "";
				_w_table_currenttd = "";
				_w_table_SpanNum = 0;
				_w_table_Obj = $(_w_table_id + " tr td:nth-child(" + _w_table_colnum + ")");
				_w_table_Obj.each(function(i) {
					if(i == 0) {
						_w_table_firsttd = $(this);
						_w_table_SpanNum = 1;
					} else {
						_w_table_currenttd = $(this);
						if(_w_table_firsttd.text() == _w_table_currenttd.text()) { //这边注意不是val（）属性，而是text（）属性
							_w_table_SpanNum++;
							_w_table_currenttd.hide(); //remove();
							_w_table_firsttd.attr("rowSpan", _w_table_SpanNum);
						} else {
							_w_table_firsttd = $(this);
							_w_table_SpanNum = 1;
						}
					}
				});
			};
		</script>
	</body>

</html>